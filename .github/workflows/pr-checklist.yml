name: PR Review Checklist

on:
  pull_request:
    types: [opened, synchronize]

jobs:
  checklist:
    name: Validate PR Requirements
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      with:
        fetch-depth: 0
    
    - name: Check for README in new directories
      run: |
        # Get list of new directories
        NEW_DIRS=$(git diff --name-only origin/main... | grep '/' | cut -d'/' -f1 | sort -u)
        
        for dir in $NEW_DIRS; do
          if [ -d "$dir" ]; then
            echo "Checking $dir..."
            
            if [ ! -f "$dir/README.md" ]; then
              echo "‚ùå Missing README.md in $dir"
              exit 1
            fi
            
            if [ ! -f "$dir/LICENSE" ]; then
              echo "‚ùå Missing LICENSE in $dir"
              exit 1
            fi
            
            if ! ls $dir/*_test.go 1> /dev/null 2>&1; then
              echo "‚ùå Missing test files in $dir"
              exit 1
            fi
            
            echo "‚úÖ $dir has required files"
          fi
        done
        
    - name: Verify main README updated
      run: |
        if git diff --name-only origin/main... | grep -q "^README.md$"; then
          echo "‚úÖ Main README.md was updated"
        else
          echo "‚ö†Ô∏è  Consider updating main README.md to list your data source"
        fi

    - name: Comment checklist on PR
      uses: actions/github-script@v7
      with:
        script: |
          const checklist = `
          ## Contribution Checklist
          
          Please ensure your PR includes:
          
          - [ ] README.md in your data source directory
          - [ ] LICENSE file (MIT, Apache 2.0, or BSD preferred)
          - [ ] Test files (*_test.go)
          - [ ] All tests passing (\`go test ./...\`)
          - [ ] Fully implements DataSource interface
          - [ ] Entry added to main README.md
          - [ ] Clear setup/usage documentation
          - [ ] No hardcoded credentials
          
          Thank you for your contribution! üéâ
          `;
          
          github.rest.issues.createComment({
            issue_number: context.issue.number,
            owner: context.repo.owner,
            repo: context.repo.repo,
            body: checklist
          });
